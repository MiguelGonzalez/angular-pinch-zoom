/*! angular-pinch-zoom - v0.3.0 */
angular.module("ngPinchZoom",[]).directive("ngPinchZoom",function(){function t(t,e,n){function i(t){var e=t.originalEvent?t.originalEvent.touches:t.touches;e.length>=2&&o(),T=e[0].clientX,M=e[0].clientY,E=X,b=D,S=0,x=0,1==e.length&&(N?(t.preventDefault(),o(),r()):(N=!0,void 0!==P&&(clearTimeout(P),P=void 0),P=setTimeout(function(){o()},275)))}function o(){N=!1,void 0!==P&&(clearTimeout(P),P=void 0)}function r(){w=m=d=1,X=0,D=0,s()}function a(t){t.preventDefault();var n=0;t.deltaY?n=t.deltaY:t.wheelDelta&&(n=-t.wheelDelta);var i=e[0].getBoundingClientRect(),o=t.pageX-i.left-window.pageXOffset,r=t.pageY-i.top-window.pageYOffset;void 0===q&&(Z=q=i.width,j=y=i.height);var a=o-X,c=r-D,l=a/q,u=c/y,v=.1;return 0>n?(q+=q*v,y+=y*v):(q-=q*v,y-=y*v),d=q/Z,d>Y?void(d=Y):(X=o-q*l,D=r-y*u,X>0?X=0:Z-q>X&&(X=Z-q),D>0?D=0:j-y>D&&(D=j-y),1>=d&&(d=1,X=0,D=0,q=Z,y=j),void s())}function c(t){o();var n=t.originalEvent?t.originalEvent.touches:t.touches;if(""===h&&(1===n.length&&d>1?h="swipe":2===n.length&&(h="pinch",m=d,p=u(n),I=n[0].clientX-parseInt((n[0].clientX-n[1].clientX)/2,10)-e[0].offsetLeft-E,k=n[0].clientY-parseInt((n[0].clientY-n[1].clientY)/2,10)-e[0].offsetTop-b)),"swipe"===h&&1===n.length)t.preventDefault(),S=n[0].clientX-T,x=n[0].clientY-M,X=E+S,D=b+x,s();else if("pinch"===h&&2===n.length){if(t.preventDefault(),g=u(n),w=g/p,d=w*m,d>Y)return void(d=Y);X=I*(1-w)+E+S,D=k*(1-w)+b+x,1>d&&(d=1,X=0,D=0),s()}}function l(t){var e=t.originalEvent?t.originalEvent.touches:t.touches;return""===h||e.length>0?void t.preventDefault():(1>d?(d=1,X=0,D=0):d>Y?(d=Y,w=d/m,X=I*(1-w)+E+S,D=k*(1-w)+b+x):(X>0?X=0:v*(1-d)>X&&(X=v*(1-d)),D>0?D=0:f*(1-d)>D&&(D=f*(1-d))),s(.1),h="",void t.preventDefault())}function u(t){var e;try{e=Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}catch(n){return alert(n),0}return parseInt(e,10)}function s(t){var n=t?"all cubic-bezier(0,0,.5,1) "+t+"s":"",i=[d,0,0,d,X,D],o="matrix("+i.join(",")+")";e.css({"-webkit-transition":n,transition:n,"-webkit-transform":o+" translate3d(0,0,0)",transform:o})}var v,f,h="",g=0,p=0,d=1,w=1,m=1,Y=parseInt(n.maxScale,10);(isNaN(Y)||1>=Y)&&(Y=3);var X=0,D=0,E=0,b=0,I=0,k=0,T=0,M=0,S=0,x=0,N=!1,O=new Image;O.onload=function(){v=e[0].clientWidth,f=e[0].clientHeight,e.css({"-webkit-transform-origin":"0 0","transform-origin":"0 0"}),e.on("touchstart",i),e.on("touchmove",c),e.on("touchend",l),e.on("wheel",a)},n.ngSrc?O.src=n.ngSrc:O.src=n.src;var P,Z,j,q,y}var e={restrict:"A",scope:!1,link:t};return e});